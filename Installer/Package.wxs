<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

  <Package
    Name="Collab ToDo Desktop"
    Manufacturer="Skymean"
    Version="1.0.0"
    UpgradeCode="D4E2A3F1-7B6C-4D9E-A1F2-3C8B5E9D0F7A"
    Scope="perMachine">

    <MajorUpgrade DowngradeErrorMessage="최신 버전이 이미 설치되어 있습니다." />
    <MediaTemplate EmbedCab="yes" />

    <Feature Id="ProductFeature" Title="Collab ToDo Desktop">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>

  </Package>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="CollabTodoDesktop" />
      </Directory>
      <Directory Id="DesktopFolder" Name="Desktop" />
      <Directory Id="ProgramMenuFolder">
        <Directory Id="AppMenuFolder" Name="Collab ToDo Desktop" />
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">

      <Component Id="MainExecutable" Guid="A1B2C3D4-E5F6-7890-ABCD-EF1234567890">
        <File Id="CollabTodoExe"
              Source="..\CollabTodoDesktop\bin\Release\net8.0-windows\win-x64\publish\CollabTodoDesktop.exe"
              KeyPath="yes" />
        <Shortcut Id="DesktopShortcut"
                  Directory="DesktopFolder"
                  Name="Collab ToDo Desktop"
                  WorkingDirectory="INSTALLFOLDER"
                  Advertise="no" />
        <Shortcut Id="StartMenuShortcut"
                  Directory="AppMenuFolder"
                  Name="Collab ToDo Desktop"
                  WorkingDirectory="INSTALLFOLDER"
                  Advertise="no" />
      </Component>

      <Component Id="AppSettings" Guid="B2C3D4E5-F6A7-8901-BCDE-F12345678901">
        <File Id="AppSettingsJson"
              Source="..\CollabTodoDesktop\bin\Release\net8.0-windows\win-x64\publish\appsettings.json" />
      </Component>

      <Component Id="CleanupMenuFolder" Guid="C3D4E5F6-A7B8-9012-CDEF-123456789012" Directory="AppMenuFolder">
        <RemoveFolder Id="RemoveAppMenuFolder" Directory="AppMenuFolder" On="uninstall" />
        <RegistryValue Root="HKCU"
                       Key="Software\CollabTodoDesktop"
                       Name="installed"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
      </Component>

    </ComponentGroup>
  </Fragment>

</Wix>
